/* Nostube Embed Player v0.1.0 | https://nostube.com */
(()=>{var yr=Object.defineProperty;var Es=(t,e,n)=>e in t?yr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Bs=(t,e)=>{for(var n in e)yr(t,n,{get:e[n],enumerable:!0})};var Yt=(t,e,n)=>Es(t,typeof e!="symbol"?e+"":e,n);function wr(){let t=new URLSearchParams(window.location.search);return{videoId:t.get("v")||"",autoplay:t.get("autoplay")==="1",muted:t.get("muted")==="1",loop:t.get("loop")==="1",startTime:parseInt(t.get("t")||"0",10),controls:t.get("controls")!=="0",showTitle:t.get("title")!=="0",showBranding:t.get("branding")!=="0",preferredQuality:t.get("quality")||"auto",customRelays:t.get("relays")?t.get("relays").split(",").map(e=>e.trim()):[],accentColor:t.get("color")||"8b5cf6"}}function br(t){return t.videoId?!t.videoId.startsWith("nevent1")&&!t.videoId.startsWith("naddr1")&&!t.videoId.startsWith("note1")?{valid:!1,error:"Invalid video ID format. Must be nevent1..., naddr1..., or note1..."}:{valid:!0}:{valid:!1,error:"Missing required parameter: v (video ID)"}}function mr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Qe(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function xr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");mr(t.outputLen),mr(t.blockLen)}function Xt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function vr(t,e){Qe(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var pe=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Er=t=>t instanceof Uint8Array;var ge=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ft=(t,e)=>t<<32-e|t>>>e,As=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!As)throw new Error("Non little-endian hardware is not supported");function Ts(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ce(t){if(typeof t=="string"&&(t=Ts(t)),!Er(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Br(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!Er(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var Qt=class{clone(){return this._cloneInto()}},Qf={}.toString;function Ar(t){let e=r=>t().update(ce(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ye(t=32){if(pe&&typeof pe.getRandomValues=="function")return pe.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Ss(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var we=class extends Qt{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ge(this.buffer)}update(e){Xt(this);let{view:n,buffer:r,blockLen:o}=this;e=ce(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=ge(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Xt(this),vr(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;Ss(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=ge(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var Ls=(t,e,n)=>t&e^~t&n,_s=(t,e,n)=>t&e^t&n^e&n,Is=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),It=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kt=new Uint32Array(64),Fe=class extends we{constructor(){super(64,32,8,!1),this.A=It[0]|0,this.B=It[1]|0,this.C=It[2]|0,this.D=It[3]|0,this.E=It[4]|0,this.F=It[5]|0,this.G=It[6]|0,this.H=It[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)kt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let g=kt[u-15],y=kt[u-2],p=ft(g,7)^ft(g,18)^g>>>3,h=ft(y,17)^ft(y,19)^y>>>10;kt[u]=h+kt[u-7]+p+kt[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let g=ft(c,6)^ft(c,11)^ft(c,25),y=l+g+Ls(c,a,f)+Is[u]+kt[u]|0,h=(ft(r,2)^ft(r,13)^ft(r,22))+_s(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){kt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var be=Ar(()=>new Fe);var rn={};Bs(rn,{bitGet:()=>Hs,bitLen:()=>Cs,bitMask:()=>ae,bitSet:()=>Ps,bytesToHex:()=>jt,bytesToNumberBE:()=>J,bytesToNumberLE:()=>ve,concatBytes:()=>vt,createHmacDrbg:()=>nn,ensureBytes:()=>K,equalBytes:()=>Os,hexToBytes:()=>Dt,hexToNumber:()=>en,numberToBytesBE:()=>lt,numberToBytesLE:()=>Ee,numberToHexUnpadded:()=>Lr,numberToVarBytesBE:()=>Rs,utf8ToBytes:()=>Ns,validateObject:()=>Ut});var Sr=BigInt(0),me=BigInt(1),ks=BigInt(2),xe=t=>t instanceof Uint8Array,Us=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function jt(t){if(!xe(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Us[t[n]];return e}function Lr(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function en(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Dt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function J(t){return en(jt(t))}function ve(t){if(!xe(t))throw new Error("Uint8Array expected");return en(jt(Uint8Array.from(t).reverse()))}function lt(t,e){return Dt(t.toString(16).padStart(e*2,"0"))}function Ee(t,e){return lt(t,e).reverse()}function Rs(t){return Dt(Lr(t))}function K(t,e,n){let r;if(typeof e=="string")try{r=Dt(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(xe(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function vt(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!xe(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function Os(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ns(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Cs(t){let e;for(e=0;t>Sr;t>>=me,e+=1);return e}function Hs(t,e){return t>>BigInt(e)&me}var Ps=(t,e,n)=>t|(n?me:Sr)<<BigInt(e),ae=t=>(ks<<BigInt(t-1))-me,tn=t=>new Uint8Array(t),Tr=t=>Uint8Array.from(t);function nn(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=tn(t),o=tn(t),s=0,i=()=>{r.fill(1),o.fill(0),s=0},c=(...u)=>n(o,r,...u),a=(u=tn())=>{o=c(Tr([0]),u),r=c(),u.length!==0&&(o=c(Tr([1]),u),r=c())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0,g=[];for(;u<e;){r=c();let y=r.slice();g.push(y),u+=r.length}return vt(...g)};return(u,g)=>{i(),a(u);let y;for(;!(y=g(f()));)a();return i(),y}}var $s={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ut(t,e,n={}){let r=(o,s,i)=>{let c=$s[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);let a=t[o];if(!(i&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(let[o,s]of Object.entries(e))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return t}var Z=BigInt(0),D=BigInt(1),zt=BigInt(2),qs=BigInt(3),on=BigInt(4),_r=BigInt(5),Ir=BigInt(8),Ms=BigInt(9),Ws=BigInt(16);function V(t,e){let n=t%e;return n>=Z?n:e+n}function js(t,e,n){if(n<=Z||e<Z)throw new Error("Expected power/modulo > 0");if(n===D)return Z;let r=D;for(;e>Z;)e&D&&(r=r*t%n),t=t*t%n,e>>=D;return r}function nt(t,e,n){let r=t;for(;e-- >Z;)r*=r,r%=n;return r}function Be(t,e){if(t===Z||e<=Z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=V(t,e),r=e,o=Z,s=D,i=D,c=Z;for(;n!==Z;){let f=r/n,l=r%n,u=o-i*f,g=s-c*f;r=n,n=l,o=i,s=c,i=u,c=g}if(r!==D)throw new Error("invert: does not exist");return V(o,e)}function Ds(t){let e=(t-D)/zt,n,r,o;for(n=t-D,r=0;n%zt===Z;n/=zt,r++);for(o=zt;o<t&&js(o,e,t)!==t-D;o++);if(r===1){let i=(t+D)/on;return function(a,f){let l=a.pow(f,i);if(!a.eql(a.sqr(l),f))throw new Error("Cannot find square root");return l}}let s=(n+D)/zt;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,l=c.pow(c.mul(c.ONE,o),n),u=c.pow(a,s),g=c.pow(a,n);for(;!c.eql(g,c.ONE);){if(c.eql(g,c.ZERO))return c.ZERO;let y=1;for(let h=c.sqr(g);y<f&&!c.eql(h,c.ONE);y++)h=c.sqr(h);let p=c.pow(l,D<<BigInt(f-y-1));l=c.sqr(p),u=c.mul(u,p),g=c.mul(g,l),f=y}return u}}function zs(t){if(t%on===qs){let e=(t+D)/on;return function(r,o){let s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%Ir===_r){let e=(t-_r)/Ir;return function(r,o){let s=r.mul(o,zt),i=r.pow(s,e),c=r.mul(o,i),a=r.mul(r.mul(c,zt),i),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return t%Ws,Ds(t)}var Ks=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sn(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Ks.reduce((r,o)=>(r[o]="function",r),e);return Ut(t,n)}function Vs(t,e,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return t.ONE;if(n===D)return e;let r=t.ONE,o=e;for(;n>Z;)n&D&&(r=t.mul(r,o)),o=t.sqr(o),n>>=D;return r}function Zs(t,e){let n=new Array(e.length),r=e.reduce((s,i,c)=>t.is0(i)?s:(n[c]=s,t.mul(s,i)),t.ONE),o=t.inv(r);return e.reduceRight((s,i,c)=>t.is0(i)?s:(n[c]=t.mul(s,n[c]),t.mul(s,i)),o),n}function cn(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function kr(t,e,n=!1,r={}){if(t<=Z)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:o,nByteLength:s}=cn(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=zs(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:ae(o),ZERO:Z,ONE:D,create:a=>V(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return Z<=a&&a<t},is0:a=>a===Z,isOdd:a=>(a&D)===D,neg:a=>V(-a,t),eql:(a,f)=>a===f,sqr:a=>V(a*a,t),add:(a,f)=>V(a+f,t),sub:(a,f)=>V(a-f,t),mul:(a,f)=>V(a*f,t),pow:(a,f)=>Vs(c,a,f),div:(a,f)=>V(a*Be(f,t),t),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>Be(a,t),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>Zs(c,a),cmov:(a,f,l)=>l?f:a,toBytes:a=>n?Ee(a,s):lt(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?ve(a):J(a)}});return Object.freeze(c)}function Ur(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function an(t){let e=Ur(t);return e+Math.ceil(e/2)}function Rr(t,e,n=!1){let r=t.length,o=Ur(e),s=an(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let i=n?J(t):ve(t),c=V(i,e-D)+D;return n?Ee(c,o):lt(c,o)}var Js=BigInt(0),fn=BigInt(1);function Or(t,e){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(e/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=t.ZERO,c=o;for(;s>Js;)s&fn&&(i=i.add(c)),c=c.double(),s>>=fn;return i},precomputeWindow(o,s){let{windows:i,windowSize:c}=r(s),a=[],f=o,l=f;for(let u=0;u<i;u++){l=f,a.push(l);for(let g=1;g<c;g++)l=l.add(f),a.push(l);f=l.double()}return a},wNAF(o,s,i){let{windows:c,windowSize:a}=r(o),f=t.ZERO,l=t.BASE,u=BigInt(2**o-1),g=2**o,y=BigInt(o);for(let p=0;p<c;p++){let h=p*a,d=Number(i&u);i>>=y,d>a&&(d-=g,i+=fn);let w=h,b=h+Math.abs(d)-1,v=p%2!==0,A=d<0;d===0?l=l.add(n(v,s[w])):f=f.add(n(A,s[b]))}return{p:f,f:l}},wNAFCached(o,s,i,c){let a=o._WINDOW_SIZE||1,f=s.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&s.set(o,c(f))),this.wNAF(a,f,i)}}}function ln(t){return sn(t.Fp),Ut(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cn(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Ys(t){let e=ln(t);Ut(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:Xs,hexToBytes:Qs}=rn,Kt={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=Kt;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Xs(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=Kt,n=typeof t=="string"?Qs(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:o,l:s}=Kt._parseInt(n.subarray(2)),{d:i,l:c}=Kt._parseInt(s);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){let e=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{let l=f.toString(16);return l.length&1?`0${l}`:l},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},Et=BigInt(0),st=BigInt(1),dl=BigInt(2),Nr=BigInt(3),pl=BigInt(4);function Fs(t){let e=Ys(t),{Fp:n}=e,r=e.toBytes||((p,h,d)=>{let w=h.toAffine();return vt(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(p=>{let h=p.subarray(1),d=n.fromBytes(h.subarray(0,n.BYTES)),w=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:d,y:w}});function s(p){let{a:h,b:d}=e,w=n.sqr(p),b=n.mul(w,p);return n.add(n.add(b,n.mul(p,h)),d)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(p){return typeof p=="bigint"&&Et<p&&p<e.n}function c(p){if(!i(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(p){let{allowedPrivateKeyLengths:h,nByteLength:d,wrapPrivateKey:w,n:b}=e;if(h&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=jt(p)),typeof p!="string"||!h.includes(p.length))throw new Error("Invalid key");p=p.padStart(d*2,"0")}let v;try{v=typeof p=="bigint"?p:J(K("private key",p,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof p}`)}return w&&(v=V(v,b)),c(v),v}let f=new Map;function l(p){if(!(p instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(h,d,w){if(this.px=h,this.py=d,this.pz=w,h==null||!n.isValid(h))throw new Error("x required");if(d==null||!n.isValid(d))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(h){let{x:d,y:w}=h||{};if(!h||!n.isValid(d)||!n.isValid(w))throw new Error("invalid affine point");if(h instanceof u)throw new Error("projective point not allowed");let b=v=>n.eql(v,n.ZERO);return b(d)&&b(w)?u.ZERO:new u(d,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let d=n.invertBatch(h.map(w=>w.pz));return h.map((w,b)=>w.toAffine(d[b])).map(u.fromAffine)}static fromHex(h){let d=u.fromAffine(o(K("pointHex",h)));return d.assertValidity(),d}static fromPrivateKey(h){return u.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,f.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:h,y:d}=this.toAffine();if(!n.isValid(h)||!n.isValid(d))throw new Error("bad point: x or y not FE");let w=n.sqr(d),b=s(h);if(!n.eql(w,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){l(h);let{px:d,py:w,pz:b}=this,{px:v,py:A,pz:I}=h,B=n.eql(n.mul(d,I),n.mul(v,b)),T=n.eql(n.mul(w,I),n.mul(A,b));return B&&T}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){let{a:h,b:d}=e,w=n.mul(d,Nr),{px:b,py:v,pz:A}=this,I=n.ZERO,B=n.ZERO,T=n.ZERO,L=n.mul(b,b),O=n.mul(v,v),U=n.mul(A,A),k=n.mul(b,v);return k=n.add(k,k),T=n.mul(b,A),T=n.add(T,T),I=n.mul(h,T),B=n.mul(w,U),B=n.add(I,B),I=n.sub(O,B),B=n.add(O,B),B=n.mul(I,B),I=n.mul(k,I),T=n.mul(w,T),U=n.mul(h,U),k=n.sub(L,U),k=n.mul(h,k),k=n.add(k,T),T=n.add(L,L),L=n.add(T,L),L=n.add(L,U),L=n.mul(L,k),B=n.add(B,L),U=n.mul(v,A),U=n.add(U,U),L=n.mul(U,k),I=n.sub(I,L),T=n.mul(U,O),T=n.add(T,T),T=n.add(T,T),new u(I,B,T)}add(h){l(h);let{px:d,py:w,pz:b}=this,{px:v,py:A,pz:I}=h,B=n.ZERO,T=n.ZERO,L=n.ZERO,O=e.a,U=n.mul(e.b,Nr),k=n.mul(d,v),P=n.mul(w,A),$=n.mul(b,I),W=n.add(d,w),m=n.add(v,A);W=n.mul(W,m),m=n.add(k,P),W=n.sub(W,m),m=n.add(d,b);let x=n.add(v,I);return m=n.mul(m,x),x=n.add(k,$),m=n.sub(m,x),x=n.add(w,b),B=n.add(A,I),x=n.mul(x,B),B=n.add(P,$),x=n.sub(x,B),L=n.mul(O,m),B=n.mul(U,$),L=n.add(B,L),B=n.sub(P,L),L=n.add(P,L),T=n.mul(B,L),P=n.add(k,k),P=n.add(P,k),$=n.mul(O,$),m=n.mul(U,m),P=n.add(P,$),$=n.sub(k,$),$=n.mul(O,$),m=n.add(m,$),k=n.mul(P,m),T=n.add(T,k),k=n.mul(x,m),B=n.mul(W,B),B=n.sub(B,k),k=n.mul(W,P),L=n.mul(x,L),L=n.add(L,k),new u(B,T,L)}subtract(h){return this.add(h.negate())}is0(){return this.equals(u.ZERO)}wNAF(h){return y.wNAFCached(this,f,h,d=>{let w=n.invertBatch(d.map(b=>b.pz));return d.map((b,v)=>b.toAffine(w[v])).map(u.fromAffine)})}multiplyUnsafe(h){let d=u.ZERO;if(h===Et)return d;if(c(h),h===st)return this;let{endo:w}=e;if(!w)return y.unsafeLadder(this,h);let{k1neg:b,k1:v,k2neg:A,k2:I}=w.splitScalar(h),B=d,T=d,L=this;for(;v>Et||I>Et;)v&st&&(B=B.add(L)),I&st&&(T=T.add(L)),L=L.double(),v>>=st,I>>=st;return b&&(B=B.negate()),A&&(T=T.negate()),T=new u(n.mul(T.px,w.beta),T.py,T.pz),B.add(T)}multiply(h){c(h);let d=h,w,b,{endo:v}=e;if(v){let{k1neg:A,k1:I,k2neg:B,k2:T}=v.splitScalar(d),{p:L,f:O}=this.wNAF(I),{p:U,f:k}=this.wNAF(T);L=y.constTimeNegate(A,L),U=y.constTimeNegate(B,U),U=new u(n.mul(U.px,v.beta),U.py,U.pz),w=L.add(U),b=O.add(k)}else{let{p:A,f:I}=this.wNAF(d);w=A,b=I}return u.normalizeZ([w,b])[0]}multiplyAndAddUnsafe(h,d,w){let b=u.BASE,v=(I,B)=>B===Et||B===st||!I.equals(b)?I.multiplyUnsafe(B):I.multiply(B),A=v(this,d).add(v(h,w));return A.is0()?void 0:A}toAffine(h){let{px:d,py:w,pz:b}=this,v=this.is0();h==null&&(h=v?n.ONE:n.inv(b));let A=n.mul(d,h),I=n.mul(w,h),B=n.mul(b,h);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:A,y:I}}isTorsionFree(){let{h,isTorsionFree:d}=e;if(h===st)return!0;if(d)return d(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:d}=e;return h===st?this:d?d(u,this):this.multiplyUnsafe(e.h)}toRawBytes(h=!0){return this.assertValidity(),r(u,this,h)}toHex(h=!0){return jt(this.toRawBytes(h))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);let g=e.nBitLength,y=Or(u,e.endo?Math.ceil(g/2):g);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function ti(t){let e=ln(t);return Ut(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Cr(t){let e=ti(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(m){return Et<m&&m<n.ORDER}function c(m){return V(m,r)}function a(m){return Be(m,r)}let{ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:g}=Fs({...e,toBytes(m,x,_){let R=x.toAffine(),E=n.toBytes(R.x),N=vt;return _?N(Uint8Array.from([x.hasEvenY()?2:3]),E):N(Uint8Array.from([4]),E,n.toBytes(R.y))},fromBytes(m){let x=m.length,_=m[0],R=m.subarray(1);if(x===o&&(_===2||_===3)){let E=J(R);if(!i(E))throw new Error("Point is not on curve");let N=u(E),M=n.sqrt(N),q=(M&st)===st;return(_&1)===1!==q&&(M=n.neg(M)),{x:E,y:M}}else if(x===s&&_===4){let E=n.fromBytes(R.subarray(0,n.BYTES)),N=n.fromBytes(R.subarray(n.BYTES,2*n.BYTES));return{x:E,y:N}}else throw new Error(`Point of length ${x} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),y=m=>jt(lt(m,e.nByteLength));function p(m){let x=r>>st;return m>x}function h(m){return p(m)?c(-m):m}let d=(m,x,_)=>J(m.slice(x,_));class w{constructor(x,_,R){this.r=x,this.s=_,this.recovery=R,this.assertValidity()}static fromCompact(x){let _=e.nByteLength;return x=K("compactSignature",x,_*2),new w(d(x,0,_),d(x,_,2*_))}static fromDER(x){let{r:_,s:R}=Kt.toSig(K("DER",x));return new w(_,R)}assertValidity(){if(!g(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!g(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(x){return new w(this.r,this.s,x)}recoverPublicKey(x){let{r:_,s:R,recovery:E}=this,N=T(K("msgHash",x));if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");let M=E===2||E===3?_+e.n:_;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let q=(E&1)===0?"02":"03",G=f.fromHex(q+y(M)),X=a(M),et=c(-N*X),ot=c(R*X),Q=f.BASE.multiplyAndAddUnsafe(G,et,ot);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Dt(this.toDERHex())}toDERHex(){return Kt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dt(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}let b={isValidPrivateKey(m){try{return l(m),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let m=an(e.n);return Rr(e.randomBytes(m),e.n)},precompute(m=8,x=f.BASE){return x._setWindowSize(m),x.multiply(BigInt(3)),x}};function v(m,x=!0){return f.fromPrivateKey(m).toRawBytes(x)}function A(m){let x=m instanceof Uint8Array,_=typeof m=="string",R=(x||_)&&m.length;return x?R===o||R===s:_?R===2*o||R===2*s:m instanceof f}function I(m,x,_=!0){if(A(m))throw new Error("first arg must be private key");if(!A(x))throw new Error("second arg must be public key");return f.fromHex(x).multiply(l(m)).toRawBytes(_)}let B=e.bits2int||function(m){let x=J(m),_=m.length*8-e.nBitLength;return _>0?x>>BigInt(_):x},T=e.bits2int_modN||function(m){return c(B(m))},L=ae(e.nBitLength);function O(m){if(typeof m!="bigint")throw new Error("bigint expected");if(!(Et<=m&&m<L))throw new Error(`bigint expected < 2^${e.nBitLength}`);return lt(m,e.nByteLength)}function U(m,x,_=k){if(["recovered","canonical"].some(tt=>tt in _))throw new Error("sign() legacy options not supported");let{hash:R,randomBytes:E}=e,{lowS:N,prehash:M,extraEntropy:q}=_;N==null&&(N=!0),m=K("msgHash",m),M&&(m=K("prehashed msgHash",R(m)));let G=T(m),X=l(x),et=[O(X),O(G)];if(q!=null){let tt=q===!0?E(n.BYTES):q;et.push(K("extraEntropy",tt))}let ot=vt(...et),Q=G;function dt(tt){let Gt=B(tt);if(!g(Gt))return;let dr=a(Gt),pt=f.BASE.multiply(Gt).toAffine(),Jt=c(pt.x);if(Jt===Et)return;let de=c(dr*c(Q+Jt*X));if(de===Et)return;let pr=(pt.x===Jt?0:2)|Number(pt.y&st),gr=de;return N&&p(de)&&(gr=h(de),pr^=1),new w(Jt,gr,pr)}return{seed:ot,k2sig:dt}}let k={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function $(m,x,_=k){let{seed:R,k2sig:E}=U(m,x,_),N=e;return nn(N.hash.outputLen,N.nByteLength,N.hmac)(R,E)}f.BASE._setWindowSize(8);function W(m,x,_,R=P){let E=m;if(x=K("msgHash",x),_=K("publicKey",_),"strict"in R)throw new Error("options.strict was renamed to lowS");let{lowS:N,prehash:M}=R,q,G;try{if(typeof E=="string"||E instanceof Uint8Array)try{q=w.fromDER(E)}catch(pt){if(!(pt instanceof Kt.Err))throw pt;q=w.fromCompact(E)}else if(typeof E=="object"&&typeof E.r=="bigint"&&typeof E.s=="bigint"){let{r:pt,s:Jt}=E;q=new w(pt,Jt)}else throw new Error("PARSE");G=f.fromHex(_)}catch(pt){if(pt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&q.hasHighS())return!1;M&&(x=e.hash(x));let{r:X,s:et}=q,ot=T(x),Q=a(et),dt=c(ot*Q),tt=c(X*Q),Gt=f.BASE.multiplyAndAddUnsafe(G,dt,tt)?.toAffine();return Gt?c(Gt.x)===X:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:I,sign:$,verify:W,ProjectivePoint:f,Signature:w,utils:b}}var Ae=class extends Qt{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,xr(e);let r=ce(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return Xt(this),this.iHash.update(e),this}digestInto(e){Xt(this),Qe(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},un=(t,e,n)=>new Ae(t,e).update(n).digest();un.create=(t,e)=>new Ae(t,e);function ei(t){return{hash:t,hmac:(e,...n)=>un(t,e,Br(...n)),randomBytes:ye}}function Hr(t,e){let n=r=>Cr({...t,...ei(r)});return Object.freeze({...n(e),create:n})}var _e=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Te=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),qr=BigInt(1),Se=BigInt(2),Pr=(t,e)=>(t+e/Se)/e;function Mr(t){let e=_e,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=t*t*t%e,l=f*f*t%e,u=nt(l,n,e)*l%e,g=nt(u,n,e)*l%e,y=nt(g,Se,e)*f%e,p=nt(y,o,e)*y%e,h=nt(p,s,e)*p%e,d=nt(h,c,e)*h%e,w=nt(d,a,e)*d%e,b=nt(w,c,e)*h%e,v=nt(b,n,e)*l%e,A=nt(v,i,e)*p%e,I=nt(A,r,e)*f%e,B=nt(I,Se,e);if(!dn.eql(dn.sqr(B),t))throw new Error("Cannot find square root");return B}var dn=kr(_e,void 0,void 0,{sqrt:Mr}),Rt=Hr({a:BigInt(0),b:BigInt(7),Fp:dn,n:Te,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Te,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-qr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=Pr(s*t,e),a=Pr(-r*t,e),f=V(t-c*n-a*o,e),l=V(-c*r-a*s,e),u=f>i,g=l>i;if(u&&(f=e-f),g&&(l=e-l),f>i||l>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:f,k2neg:g,k2:l}}}},be),Ie=BigInt(0),Wr=t=>typeof t=="bigint"&&Ie<t&&t<_e,ni=t=>typeof t=="bigint"&&Ie<t&&t<Te,$r={};function Le(t,...e){let n=$r[t];if(n===void 0){let r=be(Uint8Array.from(t,o=>o.charCodeAt(0)));n=vt(r,r),$r[t]=n}return be(vt(n,...e))}var yn=t=>t.toRawBytes(!0).slice(1),pn=t=>lt(t,32),hn=t=>V(t,_e),fe=t=>V(t,Te),wn=Rt.ProjectivePoint,ri=(t,e,n)=>wn.BASE.multiplyAndAddUnsafe(t,e,n);function gn(t){let e=Rt.utils.normPrivateKeyToScalar(t),n=wn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:fe(-e),bytes:yn(n)}}function jr(t){if(!Wr(t))throw new Error("bad x: need 0 < x < p");let e=hn(t*t),n=hn(e*t+BigInt(7)),r=Mr(n);r%Se!==Ie&&(r=hn(-r));let o=new wn(t,r,qr);return o.assertValidity(),o}function Dr(...t){return fe(J(Le("BIP0340/challenge",...t)))}function oi(t){return gn(t).bytes}function si(t,e,n=ye(32)){let r=K("message",t),{bytes:o,scalar:s}=gn(e),i=K("auxRand",n,32),c=pn(s^J(Le("BIP0340/aux",i))),a=Le("BIP0340/nonce",c,o,r),f=fe(J(a));if(f===Ie)throw new Error("sign failed: k is zero");let{bytes:l,scalar:u}=gn(f),g=Dr(l,o,r),y=new Uint8Array(64);if(y.set(l,0),y.set(pn(fe(u+g*s)),32),!zr(y,r,o))throw new Error("sign: Invalid signature produced");return y}function zr(t,e,n){let r=K("signature",t,64),o=K("message",e),s=K("publicKey",n,32);try{let i=jr(J(s)),c=J(r.subarray(0,32));if(!Wr(c))return!1;let a=J(r.subarray(32,64));if(!ni(a))return!1;let f=Dr(pn(c),yn(i),o),l=ri(i,a,fe(-f));return!(!l||!l.hasEvenY()||l.toAffine().x!==c)}catch{return!1}}var Ft={getPublicKey:oi,sign:si,verify:zr,utils:{randomPrivateKey:Rt.utils.randomPrivateKey,lift_x:jr,pointToBytes:yn,numberToBytesBE:lt,bytesToNumberBE:J,taggedHash:Le,mod:V}};var ke=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var bn=t=>t instanceof Uint8Array;var Ue=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ut=(t,e)=>t<<32-e|t>>>e,ii=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ii)throw new Error("Non little-endian hardware is not supported");var ci=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function z(t){if(!bn(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=ci[t[n]];return e}function Bt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function ai(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ot(t){if(typeof t=="string"&&(t=ai(t)),!bn(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ee(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!bn(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var te=class{clone(){return this._cloneInto()}};function mn(t){let e=r=>t().update(Ot(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Re(t=32){if(ke&&typeof ke.getRandomValues=="function")return ke.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function xn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function fi(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Kr(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function li(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xn(t.outputLen),xn(t.blockLen)}function ui(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function hi(t,e){Kr(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var di={number:xn,bool:fi,bytes:Kr,hash:li,exists:ui,output:hi},rt=di;function pi(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Oe=class extends te{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ue(this.buffer)}update(e){rt.exists(this);let{view:n,buffer:r,blockLen:o}=this;e=Ot(e);let s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Ue(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rt.exists(this),rt.output(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;pi(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=Ue(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return e.length=o,e.pos=c,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};var gi=(t,e,n)=>t&e^~t&n,yi=(t,e,n)=>t&e^t&n^e&n,wi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Nt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ct=new Uint32Array(64),Ne=class extends Oe{constructor(){super(64,32,8,!1),this.A=Nt[0]|0,this.B=Nt[1]|0,this.C=Nt[2]|0,this.D=Nt[3]|0,this.E=Nt[4]|0,this.F=Nt[5]|0,this.G=Nt[6]|0,this.H=Nt[7]|0}get(){let{A:e,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[e,n,r,o,s,i,c,a]}set(e,n,r,o,s,i,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)Ct[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){let g=Ct[u-15],y=Ct[u-2],p=ut(g,7)^ut(g,18)^g>>>3,h=ut(y,17)^ut(y,19)^y>>>10;Ct[u]=h+Ct[u-7]+p+Ct[u-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let g=ut(c,6)^ut(c,11)^ut(c,25),y=l+g+gi(c,a,f)+wi[u]+Ct[u]|0,h=(ut(r,2)^ut(r,13)^ut(r,22))+yi(r,o,s)|0;l=f,f=a,a=c,c=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,a,f,l)}roundClean(){Ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},vn=class extends Ne{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},gt=mn(()=>new Ne),$l=mn(()=>new vn);function ne(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function At(...t){let e=(o,s)=>i=>o(s(i)),n=Array.from(t).reverse().reduce((o,s)=>o?e(o,s.encode):s.encode,void 0),r=t.reduce((o,s)=>o?e(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Tt(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(ne(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function St(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function He(t,e="="){if(ne(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Xr(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function Vr(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0,o=[],s=Array.from(t);for(s.forEach(i=>{if(ne(i),i<0||i>=e)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){let f=s[a],l=e*i+f;if(!Number.isSafeInteger(l)||e*i/e!==i||l-f!==e*i)throw new Error("convertRadix: carry overflow");if(i=l%n,s[a]=Math.floor(l/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==l)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<t.length-1&&t[i]===0;i++)o.push(0);return o.reverse()}var Qr=(t,e)=>e?Qr(e,t%e):t,Ce=(t,e)=>t+(e-Qr(t,e));function En(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ce(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Ce(e,n)}`);let o=0,s=0,i=2**n-1,c=[];for(let a of t){if(ne(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function bi(t){return ne(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Vr(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Vr(e,t,2**8))}}}function Ht(t,e=!1){if(ne(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Ce(8,t)>32||Ce(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return En(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(En(n,t,8,e))}}}function Zr(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}var mi=At(Ht(4),Tt("0123456789ABCDEF"),St("")),xi=At(Ht(5),Tt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),He(5),St("")),Ml=At(Ht(5),Tt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),He(5),St("")),Wl=At(Ht(5),Tt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),St(""),Xr(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),it=At(Ht(6),Tt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),He(6),St("")),vi=At(Ht(6),Tt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),He(6),St("")),Tn=t=>At(bi(58),Tt(t),St("")),Bn=Tn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),jl=Tn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Dl=Tn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Gr=[0,2,3,5,6,7,9,10,11],Ei={encode(t){let e="";for(let n=0;n<t.length;n+=8){let r=t.subarray(n,n+8);e+=Bn.encode(r).padStart(Gr[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){let r=t.slice(n,n+11),o=Gr.indexOf(r.length),s=Bn.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(e)}};var An=At(Tt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),St("")),Jr=[996825010,642813549,513874426,1027748829,705979059];function le(t){let e=t>>25,n=(t&33554431)<<5;for(let r=0;r<Jr.length;r++)(e>>r&1)===1&&(n^=Jr[r]);return n}function Yr(t,e,n=1){let r=t.length,o=1;for(let s=0;s<r;s++){let i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=le(o)^i>>5}o=le(o);for(let s=0;s<r;s++)o=le(o)^t.charCodeAt(s)&31;for(let s of e)o=le(o)^s;for(let s=0;s<6;s++)o=le(o);return o^=n,An.encode(En([o%2**30],30,5,!1))}function Fr(t){let e=t==="bech32"?1:734539939,n=Ht(5),r=n.decode,o=n.encode,s=Zr(r);function i(l,u,g=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);let y=l.length+7+u.length;if(g!==!1&&y>g)throw new TypeError(`Length ${y} exceeds limit ${g}`);return l=l.toLowerCase(),`${l}1${An.encode(u)}${Yr(l,u,e)}`}function c(l,u=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||u!==!1&&l.length>u)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${u})`);let g=l.toLowerCase();if(l!==g&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=g;let y=l.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');let p=l.slice(0,y),h=l.slice(y+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");let d=An.decode(h).slice(0,-6),w=Yr(p,d,e);if(!h.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:p,words:d}}let a=Zr(c);function f(l){let{prefix:u,words:g}=c(l,!1);return{prefix:u,words:g,bytes:r(g)}}return{encode:i,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}var Pt=Fr("bech32"),zl=Fr("bech32m"),Bi={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},Ai=At(Ht(4),Tt("0123456789abcdef"),St(""),Xr(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Ti={utf8:Bi,hex:Ai,base16:mi,base32:xi,base64:it,base64url:vi,base58:Bn,base58xmr:Ei},Kl=`Invalid encoding type. Available types: ${Object.keys(Ti).join(", ")}`;function Pe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Sn(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Ln(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function C(t,...e){if(!Ln(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function $t(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ue(t,e){C(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var $e=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);var H=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),qt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Si=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Si)throw new Error("Non little-endian hardware is not supported");function Li(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function yt(t){if(typeof t=="string")t=Li(t);else if(Ln(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function to(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Vt(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var wt=(t,e)=>(Object.assign(e,t),e);function Zt(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+f,c,r)}var Lt=16,In=new Uint8Array(16),bt=H(In),_i=225,Ii=(t,e,n,r)=>{let o=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^_i<<24&-(o&1)}},ct=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function ki(t){t.reverse();let e=t[15]&1,n=0;for(let r=0;r<t.length;r++){let o=t[r];t[r]=o>>>1|n,n=(o&1)<<7}return t[0]^=-e&225,t}var Ui=t=>t>64*1024?8:t>1024?4:2,qe=class{constructor(e,n){this.blockLen=Lt,this.outputLen=Lt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=yt(e),C(e,16);let r=qt(e),o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),c=r.getUint32(12,!1),a=[];for(let p=0;p<128;p++)a.push({s0:ct(o),s1:ct(s),s2:ct(i),s3:ct(c)}),{s0:o,s1:s,s2:i,s3:c}=Ii(o,s,i,c);let f=Ui(n||1024);if(![1,2,4,8].includes(f))throw new Error(`ghash: wrong window size=${f}, should be 2, 4 or 8`);this.W=f;let u=128/f,g=this.windowSize=2**f,y=[];for(let p=0;p<u;p++)for(let h=0;h<g;h++){let d=0,w=0,b=0,v=0;for(let A=0;A<f;A++){if(!(h>>>f-A-1&1))continue;let{s0:B,s1:T,s2:L,s3:O}=a[f*p+A];d^=B,w^=T,b^=L,v^=O}y.push({s0:d,s1:w,s2:b,s3:v})}this.t=y}_updateBlock(e,n,r,o){e^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;let{W:s,t:i,windowSize:c}=this,a=0,f=0,l=0,u=0,g=(1<<s)-1,y=0;for(let p of[e,n,r,o])for(let h=0;h<4;h++){let d=p>>>8*h&255;for(let w=8/s-1;w>=0;w--){let b=d>>>s*w&g,{s0:v,s1:A,s2:I,s3:B}=i[y*c+b];a^=v,f^=A,l^=I,u^=B,y+=1}}this.s0=a,this.s1=f,this.s2=l,this.s3=u}update(e){e=yt(e),$t(this);let n=H(e),r=Math.floor(e.length/Lt),o=e.length%Lt;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(In.set(e.subarray(r*Lt)),this._updateBlock(bt[0],bt[1],bt[2],bt[3]),bt.fill(0)),this}destroy(){let{t:e}=this;for(let n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){$t(this),ue(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e}digest(){let e=new Uint8Array(Lt);return this.digestInto(e),this.destroy(),e}},_n=class extends qe{constructor(e,n){e=yt(e);let r=ki(e.slice());super(r,n),r.fill(0)}update(e){e=yt(e),$t(this);let n=H(e),r=e.length%Lt,o=Math.floor(e.length/Lt);for(let s=0;s<o;s++)this._updateBlock(ct(n[s*4+3]),ct(n[s*4+2]),ct(n[s*4+1]),ct(n[s*4+0]));return r&&(In.set(e.subarray(o*Lt)),this._updateBlock(ct(bt[3]),ct(bt[2]),ct(bt[1]),ct(bt[0])),bt.fill(0)),this}digestInto(e){$t(this),ue(e,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=H(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e.reverse()}};function eo(t){let e=(r,o)=>t(o,r.length).update(yt(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,o)=>t(r,o),e}var kn=eo((t,e)=>new qe(t,e)),no=eo((t,e)=>new _n(t,e));var F=16,On=4,Me=new Uint8Array(F),Ri=283;function Nn(t){return t<<1^Ri&-(t>>7)}function re(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=Nn(t);return n}var Rn=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Nn(r))t[n]=r;let e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),Oi=Rn.map((t,e)=>Rn.indexOf(e)),Ni=t=>t<<24|t>>>8,Un=t=>t<<8|t>>>24;function ro(t,e){if(t.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((f,l)=>e(t[l])),r=n.map(Un),o=r.map(Un),s=o.map(Un),i=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let l=0;l<256;l++){let u=f*256+l;i[u]=n[f]^r[l],c[u]=o[f]^s[l],a[u]=t[f]<<8|t[l]}return{sbox:t,sbox2:a,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}var Cn=ro(Rn,t=>re(t,3)<<24|t<<16|t<<8|re(t,2)),oo=ro(Oi,t=>re(t,11)<<24|re(t,13)<<16|re(t,9)<<8|re(t,14)),Ci=(()=>{let t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=Nn(n))t[e]=n;return t})();function Wt(t){C(t);let e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);let{sbox2:n}=Cn,r=H(t),o=r.length,s=c=>mt(n,c,c,c,c),i=new Uint32Array(e+28);i.set(r);for(let c=o;c<i.length;c++){let a=i[c-1];c%o===0?a=s(Ni(a))^Ci[c/o-1]:o>6&&c%o===4&&(a=s(a)),i[c]=i[c-o]^a}return i}function so(t){let e=Wt(t),n=e.slice(),r=e.length,{sbox2:o}=Cn,{T0:s,T1:i,T2:c,T3:a}=oo;for(let f=0;f<r;f+=4)for(let l=0;l<4;l++)n[f+l]=e[r-f-4+l];e.fill(0);for(let f=4;f<r-4;f++){let l=n[f],u=mt(o,l,l,l,l);n[f]=s[u&255]^i[u>>>8&255]^c[u>>>16&255]^a[u>>>24]}return n}function Mt(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function mt(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function at(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=Cn,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let p=0;p<f;p++){let h=t[a++]^Mt(i,c,e,n,r,o),d=t[a++]^Mt(i,c,n,r,o,e),w=t[a++]^Mt(i,c,r,o,e,n),b=t[a++]^Mt(i,c,o,e,n,r);e=h,n=d,r=w,o=b}let l=t[a++]^mt(s,e,n,r,o),u=t[a++]^mt(s,n,r,o,e),g=t[a++]^mt(s,r,o,e,n),y=t[a++]^mt(s,o,e,n,r);return{s0:l,s1:u,s2:g,s3:y}}function io(t,e,n,r,o){let{sbox2:s,T01:i,T23:c}=oo,a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];let f=t.length/4-2;for(let p=0;p<f;p++){let h=t[a++]^Mt(i,c,e,o,r,n),d=t[a++]^Mt(i,c,n,e,o,r),w=t[a++]^Mt(i,c,r,n,e,o),b=t[a++]^Mt(i,c,o,r,n,e);e=h,n=d,r=w,o=b}let l=t[a++]^mt(s,e,o,r,n),u=t[a++]^mt(s,n,e,o,r),g=t[a++]^mt(s,r,n,e,o),y=t[a++]^mt(s,o,r,n,e);return{s0:l,s1:u,s2:g,s3:y}}function oe(t,e){if(!e)return new Uint8Array(t);if(C(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function Hi(t,e,n,r){C(e,F),C(n);let o=n.length;r=oe(o,r);let s=e,i=H(s),{s0:c,s1:a,s2:f,s3:l}=at(t,i[0],i[1],i[2],i[3]),u=H(n),g=H(r);for(let p=0;p+4<=u.length;p+=4){g[p+0]=u[p+0]^c,g[p+1]=u[p+1]^a,g[p+2]=u[p+2]^f,g[p+3]=u[p+3]^l;let h=1;for(let d=s.length-1;d>=0;d--)h=h+(s[d]&255)|0,s[d]=h&255,h>>>=8;({s0:c,s1:a,s2:f,s3:l}=at(t,i[0],i[1],i[2],i[3]))}let y=F*Math.floor(u.length/On);if(y<o){let p=new Uint32Array([c,a,f,l]),h=$e(p);for(let d=y,w=0;d<o;d++,w++)r[d]=n[d]^h[w]}return r}function he(t,e,n,r,o){C(n,F),C(r),o=oe(r.length,o);let s=n,i=H(s),c=qt(s),a=H(r),f=H(o),l=e?0:12,u=r.length,g=c.getUint32(l,e),{s0:y,s1:p,s2:h,s3:d}=at(t,i[0],i[1],i[2],i[3]);for(let b=0;b+4<=a.length;b+=4)f[b+0]=a[b+0]^y,f[b+1]=a[b+1]^p,f[b+2]=a[b+2]^h,f[b+3]=a[b+3]^d,g=g+1>>>0,c.setUint32(l,g,e),{s0:y,s1:p,s2:h,s3:d}=at(t,i[0],i[1],i[2],i[3]);let w=F*Math.floor(a.length/On);if(w<u){let b=new Uint32Array([y,p,h,d]),v=$e(b);for(let A=w,I=0;A<u;A++,I++)o[A]=r[A]^v[I]}return o}var nu=wt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,F);function r(o,s){let i=Wt(e),c=n.slice(),a=Hi(i,c,o,s);return i.fill(0),c.fill(0),a}return{encrypt:(o,s)=>r(o,s),decrypt:(o,s)=>r(o,s)}});function co(t){if(C(t),t.length%F!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${F}`)}function ao(t,e,n){let r=t.length,o=r%F;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=H(t);if(e){let a=F-o;a||(a=F),r=r+a}let i=oe(r,n),c=H(i);return{b:s,o:c,out:i}}function fo(t,e){if(!e)return t;let n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let o=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function lo(t){let e=new Uint8Array(16),n=H(e);e.set(t);let r=F-t.length;for(let o=F-r;o<F;o++)e[o]=r;return n}var ru=wt({blockSize:16},function(e,n={}){C(e);let r=!n.disablePadding;return{encrypt:(o,s)=>{C(o);let{b:i,o:c,out:a}=ao(o,r,s),f=Wt(e),l=0;for(;l+4<=i.length;){let{s0:u,s1:g,s2:y,s3:p}=at(f,i[l+0],i[l+1],i[l+2],i[l+3]);c[l++]=u,c[l++]=g,c[l++]=y,c[l++]=p}if(r){let u=lo(o.subarray(l*4)),{s0:g,s1:y,s2:p,s3:h}=at(f,u[0],u[1],u[2],u[3]);c[l++]=g,c[l++]=y,c[l++]=p,c[l++]=h}return f.fill(0),a},decrypt:(o,s)=>{co(o);let i=so(e),c=oe(o.length,s),a=H(o),f=H(c);for(let l=0;l+4<=a.length;){let{s0:u,s1:g,s2:y,s3:p}=io(i,a[l+0],a[l+1],a[l+2],a[l+3]);f[l++]=u,f[l++]=g,f[l++]=y,f[l++]=p}return i.fill(0),fo(c,r)}}}),Hn=wt({blockSize:16,nonceLength:16},function(e,n,r={}){C(e),C(n,16);let o=!r.disablePadding;return{encrypt:(s,i)=>{let c=Wt(e),{b:a,o:f,out:l}=ao(s,o,i),u=H(n),g=u[0],y=u[1],p=u[2],h=u[3],d=0;for(;d+4<=a.length;)g^=a[d+0],y^=a[d+1],p^=a[d+2],h^=a[d+3],{s0:g,s1:y,s2:p,s3:h}=at(c,g,y,p,h),f[d++]=g,f[d++]=y,f[d++]=p,f[d++]=h;if(o){let w=lo(s.subarray(d*4));g^=w[0],y^=w[1],p^=w[2],h^=w[3],{s0:g,s1:y,s2:p,s3:h}=at(c,g,y,p,h),f[d++]=g,f[d++]=y,f[d++]=p,f[d++]=h}return c.fill(0),l},decrypt:(s,i)=>{co(s);let c=so(e),a=H(n),f=oe(s.length,i),l=H(s),u=H(f),g=a[0],y=a[1],p=a[2],h=a[3];for(let d=0;d+4<=l.length;){let w=g,b=y,v=p,A=h;g=l[d+0],y=l[d+1],p=l[d+2],h=l[d+3];let{s0:I,s1:B,s2:T,s3:L}=io(c,g,y,p,h);u[d++]=I^w,u[d++]=B^b,u[d++]=T^v,u[d++]=L^A}return c.fill(0),fo(f,o)}}}),ou=wt({blockSize:16,nonceLength:16},function(e,n){C(e),C(n,16);function r(o,s,i){let c=Wt(e),a=o.length;i=oe(a,i);let f=H(o),l=H(i),u=s?l:f,g=H(n),y=g[0],p=g[1],h=g[2],d=g[3];for(let b=0;b+4<=f.length;){let{s0:v,s1:A,s2:I,s3:B}=at(c,y,p,h,d);l[b+0]=f[b+0]^v,l[b+1]=f[b+1]^A,l[b+2]=f[b+2]^I,l[b+3]=f[b+3]^B,y=u[b++],p=u[b++],h=u[b++],d=u[b++]}let w=F*Math.floor(f.length/On);if(w<a){({s0:y,s1:p,s2:h,s3:d}=at(c,y,p,h,d));let b=$e(new Uint32Array([y,p,h,d]));for(let v=w,A=0;v<a;v++,A++)i[v]=o[v]^b[A];b.fill(0)}return c.fill(0),i}return{encrypt:(o,s)=>r(o,!0,s),decrypt:(o,s)=>r(o,!1,s)}});function uo(t,e,n,r,o){let s=t.create(n,r.length+(o?.length||0));o&&s.update(o),s.update(r);let i=new Uint8Array(16),c=qt(i);return o&&Zt(c,0,BigInt(o.length*8),e),Zt(c,8,BigInt(r.length*8),e),s.update(i),s.digest()}var su=wt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){if(C(n),n.length===0)throw new Error("aes/gcm: empty nonce");let o=16;function s(c,a,f){let l=uo(kn,!1,c,f,r);for(let u=0;u<a.length;u++)l[u]^=a[u];return l}function i(){let c=Wt(e),a=Me.slice(),f=Me.slice();if(he(c,!1,f,f,a),n.length===12)f.set(n);else{let u=Me.slice(),g=qt(u);Zt(g,8,BigInt(n.length*8),!1),kn.create(a).update(n).update(u).digestInto(f)}let l=he(c,!1,f,Me);return{xk:c,authKey:a,counter:f,tagMask:l}}return{encrypt:c=>{C(c);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),g=new Uint8Array(c.length+o);he(a,!1,l,c,g);let y=s(f,u,g.subarray(0,g.length-o));return g.set(y,c.length),a.fill(0),g},decrypt:c=>{if(C(c),c.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);let{xk:a,authKey:f,counter:l,tagMask:u}=i(),g=c.subarray(0,-o),y=c.subarray(-o),p=s(f,u,g);if(!Vt(p,y))throw new Error("aes/gcm: invalid ghash tag");let h=he(a,!1,l,g);return f.fill(0),u.fill(0),a.fill(0),h}}}),We=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)},iu=wt({blockSize:16,nonceLength:12,tagLength:16},function(e,n,r){let s=We("AAD",0,68719476736),i=We("plaintext",0,2**36),c=We("nonce",12,12),a=We("ciphertext",16,2**36+16);C(n),c(n.length),r&&(C(r),s(r.length));function f(){let g=e.length;if(g!==16&&g!==24&&g!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${g} bytes`);let y=Wt(e),p=new Uint8Array(g),h=new Uint8Array(16),d=H(n),w=0,b=d[0],v=d[1],A=d[2],I=0;for(let B of[h,p].map(H)){let T=H(B);for(let L=0;L<T.length;L+=2){let{s0:O,s1:U}=at(y,w,b,v,A);T[L+0]=O,T[L+1]=U,w=++I}}return y.fill(0),{authKey:h,encKey:Wt(p)}}function l(g,y,p){let h=uo(no,!0,y,p,r);for(let I=0;I<12;I++)h[I]^=n[I];h[15]&=127;let d=H(h),w=d[0],b=d[1],v=d[2],A=d[3];return{s0:w,s1:b,s2:v,s3:A}=at(g,w,b,v,A),d[0]=w,d[1]=b,d[2]=v,d[3]=A,h}function u(g,y,p){let h=y.slice();return h[15]|=128,he(g,!0,h,p)}return{encrypt:g=>{C(g),i(g.length);let{encKey:y,authKey:p}=f(),h=l(y,p,g),d=new Uint8Array(g.length+16);return d.set(h,g.length),d.set(u(y,h,g)),y.fill(0),p.fill(0),d},decrypt:g=>{C(g),a(g.length);let y=g.subarray(-16),{encKey:p,authKey:h}=f(),d=u(p,y,g.subarray(0,-16)),w=l(p,h,d);if(p.fill(0),h.fill(0),!Vt(y,w))throw new Error("invalid polyval tag");return d}}});var Y=(t,e)=>t[e++]&255|(t[e++]&255)<<8,Pn=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=yt(e),C(e,32);let n=Y(e,0),r=Y(e,2),o=Y(e,4),s=Y(e,6),i=Y(e,8),c=Y(e,10),a=Y(e,12),f=Y(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Y(e,16+2*l)}process(e,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,c=i[0],a=i[1],f=i[2],l=i[3],u=i[4],g=i[5],y=i[6],p=i[7],h=i[8],d=i[9],w=Y(e,n+0),b=Y(e,n+2),v=Y(e,n+4),A=Y(e,n+6),I=Y(e,n+8),B=Y(e,n+10),T=Y(e,n+12),L=Y(e,n+14),O=s[0]+(w&8191),U=s[1]+((w>>>13|b<<3)&8191),k=s[2]+((b>>>10|v<<6)&8191),P=s[3]+((v>>>7|A<<9)&8191),$=s[4]+((A>>>4|I<<12)&8191),W=s[5]+(I>>>1&8191),m=s[6]+((I>>>14|B<<2)&8191),x=s[7]+((B>>>11|T<<5)&8191),_=s[8]+((T>>>8|L<<8)&8191),R=s[9]+(L>>>5|o),E=0,N=E+O*c+U*(5*d)+k*(5*h)+P*(5*p)+$*(5*y);E=N>>>13,N&=8191,N+=W*(5*g)+m*(5*u)+x*(5*l)+_*(5*f)+R*(5*a),E+=N>>>13,N&=8191;let M=E+O*a+U*c+k*(5*d)+P*(5*h)+$*(5*p);E=M>>>13,M&=8191,M+=W*(5*y)+m*(5*g)+x*(5*u)+_*(5*l)+R*(5*f),E+=M>>>13,M&=8191;let q=E+O*f+U*a+k*c+P*(5*d)+$*(5*h);E=q>>>13,q&=8191,q+=W*(5*p)+m*(5*y)+x*(5*g)+_*(5*u)+R*(5*l),E+=q>>>13,q&=8191;let G=E+O*l+U*f+k*a+P*c+$*(5*d);E=G>>>13,G&=8191,G+=W*(5*h)+m*(5*p)+x*(5*y)+_*(5*g)+R*(5*u),E+=G>>>13,G&=8191;let X=E+O*u+U*l+k*f+P*a+$*c;E=X>>>13,X&=8191,X+=W*(5*d)+m*(5*h)+x*(5*p)+_*(5*y)+R*(5*g),E+=X>>>13,X&=8191;let et=E+O*g+U*u+k*l+P*f+$*a;E=et>>>13,et&=8191,et+=W*c+m*(5*d)+x*(5*h)+_*(5*p)+R*(5*y),E+=et>>>13,et&=8191;let ot=E+O*y+U*g+k*u+P*l+$*f;E=ot>>>13,ot&=8191,ot+=W*a+m*c+x*(5*d)+_*(5*h)+R*(5*p),E+=ot>>>13,ot&=8191;let Q=E+O*p+U*y+k*g+P*u+$*l;E=Q>>>13,Q&=8191,Q+=W*f+m*a+x*c+_*(5*d)+R*(5*h),E+=Q>>>13,Q&=8191;let dt=E+O*h+U*p+k*y+P*g+$*u;E=dt>>>13,dt&=8191,dt+=W*l+m*f+x*a+_*c+R*(5*d),E+=dt>>>13,dt&=8191;let tt=E+O*d+U*h+k*p+P*y+$*g;E=tt>>>13,tt&=8191,tt+=W*u+m*l+x*f+_*a+R*c,E+=tt>>>13,tt&=8191,E=(E<<2)+E|0,E=E+N|0,N=E&8191,E=E>>>13,M+=E,s[0]=N,s[1]=M,s[2]=q,s[3]=G,s[4]=X,s[5]=et,s[6]=ot,s[7]=Q,s[8]=dt,s[9]=tt}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=o,o=e[c]>>>13,e[c]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=e[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)e[c]=e[c]&s|r[c];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+n[0];e[0]=i&65535;for(let c=1;c<8;c++)i=(e[c]+n[c]|0)+(i>>>16)|0,e[c]=i&65535}update(e){$t(this);let{buffer:n,blockLen:r}=this;e=yt(e);let o=e.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){$t(this),ue(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function Pi(t){let e=(r,o)=>t(o).update(yt(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var ho=Pi(t=>new Pn(t));var go=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),$i=go("expand 16-byte k"),qi=go("expand 32-byte k"),Mi=H($i),yo=H(qi),du=yo.slice();function S(t,e){return t<<e|t>>>32-e}function $n(t){return t.byteOffset%4===0}var je=64,Wi=16,wo=2**32-1,po=new Uint32Array;function ji(t,e,n,r,o,s,i,c){let a=o.length,f=new Uint8Array(je),l=H(f),u=$n(o)&&$n(s),g=u?H(o):po,y=u?H(s):po;for(let p=0;p<a;i++){if(t(e,n,r,l,i,c),i>=wo)throw new Error("arx: counter overflow");let h=Math.min(je,a-p);if(u&&h===je){let d=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let w=0,b;w<Wi;w++)b=d+w,y[b]=g[b]^l[w];p+=je;continue}for(let d=0,w;d<h;d++)w=p+d,s[w]=o[w]^f[d];p+=h}}function qn(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=to({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Pe(o),Pe(i),Sn(s),Sn(n),(c,a,f,l,u=0)=>{C(c),C(a),C(f);let g=f.length;if(l||(l=new Uint8Array(g)),C(l),Pe(u),u<0||u>=wo)throw new Error("arx: counter overflow");if(l.length<g)throw new Error(`arx: output (${l.length}) is shorter than data (${g})`);let y=[],p=c.length,h,d;if(p===32)h=c.slice(),y.push(h),d=yo;else if(p===16&&n)h=new Uint8Array(32),h.set(c),h.set(c,16),d=Mi,y.push(h);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);$n(a)||(a=a.slice(),y.push(a));let w=H(h);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,w,H(a.subarray(0,16)),w),a=a.subarray(16)}let b=16-o;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){let A=new Uint8Array(12);A.set(a,s?0:12-a.length),a=A,y.push(a)}let v=H(a);for(ji(t,d,w,v,f,l,u,i);y.length>0;)y.pop().fill(0);return l}}function xo(t,e,n,r,o,s=20){let i=t[0],c=t[1],a=t[2],f=t[3],l=e[0],u=e[1],g=e[2],y=e[3],p=e[4],h=e[5],d=e[6],w=e[7],b=o,v=n[0],A=n[1],I=n[2],B=i,T=c,L=a,O=f,U=l,k=u,P=g,$=y,W=p,m=h,x=d,_=w,R=b,E=v,N=A,M=I;for(let G=0;G<s;G+=2)B=B+U|0,R=S(R^B,16),W=W+R|0,U=S(U^W,12),B=B+U|0,R=S(R^B,8),W=W+R|0,U=S(U^W,7),T=T+k|0,E=S(E^T,16),m=m+E|0,k=S(k^m,12),T=T+k|0,E=S(E^T,8),m=m+E|0,k=S(k^m,7),L=L+P|0,N=S(N^L,16),x=x+N|0,P=S(P^x,12),L=L+P|0,N=S(N^L,8),x=x+N|0,P=S(P^x,7),O=O+$|0,M=S(M^O,16),_=_+M|0,$=S($^_,12),O=O+$|0,M=S(M^O,8),_=_+M|0,$=S($^_,7),B=B+k|0,M=S(M^B,16),x=x+M|0,k=S(k^x,12),B=B+k|0,M=S(M^B,8),x=x+M|0,k=S(k^x,7),T=T+P|0,R=S(R^T,16),_=_+R|0,P=S(P^_,12),T=T+P|0,R=S(R^T,8),_=_+R|0,P=S(P^_,7),L=L+$|0,E=S(E^L,16),W=W+E|0,$=S($^W,12),L=L+$|0,E=S(E^L,8),W=W+E|0,$=S($^W,7),O=O+U|0,N=S(N^O,16),m=m+N|0,U=S(U^m,12),O=O+U|0,N=S(N^O,8),m=m+N|0,U=S(U^m,7);let q=0;r[q++]=i+B|0,r[q++]=c+T|0,r[q++]=a+L|0,r[q++]=f+O|0,r[q++]=l+U|0,r[q++]=u+k|0,r[q++]=g+P|0,r[q++]=y+$|0,r[q++]=p+W|0,r[q++]=h+m|0,r[q++]=d+x|0,r[q++]=w+_|0,r[q++]=b+R|0,r[q++]=v+E|0,r[q++]=A+N|0,r[q++]=I+M|0}function Di(t,e,n,r){let o=t[0],s=t[1],i=t[2],c=t[3],a=e[0],f=e[1],l=e[2],u=e[3],g=e[4],y=e[5],p=e[6],h=e[7],d=n[0],w=n[1],b=n[2],v=n[3];for(let I=0;I<20;I+=2)o=o+a|0,d=S(d^o,16),g=g+d|0,a=S(a^g,12),o=o+a|0,d=S(d^o,8),g=g+d|0,a=S(a^g,7),s=s+f|0,w=S(w^s,16),y=y+w|0,f=S(f^y,12),s=s+f|0,w=S(w^s,8),y=y+w|0,f=S(f^y,7),i=i+l|0,b=S(b^i,16),p=p+b|0,l=S(l^p,12),i=i+l|0,b=S(b^i,8),p=p+b|0,l=S(l^p,7),c=c+u|0,v=S(v^c,16),h=h+v|0,u=S(u^h,12),c=c+u|0,v=S(v^c,8),h=h+v|0,u=S(u^h,7),o=o+f|0,v=S(v^o,16),p=p+v|0,f=S(f^p,12),o=o+f|0,v=S(v^o,8),p=p+v|0,f=S(f^p,7),s=s+l|0,d=S(d^s,16),h=h+d|0,l=S(l^h,12),s=s+l|0,d=S(d^s,8),h=h+d|0,l=S(l^h,7),i=i+u|0,w=S(w^i,16),g=g+w|0,u=S(u^g,12),i=i+u|0,w=S(w^i,8),g=g+w|0,u=S(u^g,7),c=c+a|0,b=S(b^c,16),y=y+b|0,a=S(a^y,12),c=c+a|0,b=S(b^c,8),y=y+b|0,a=S(a^y,7);let A=0;r[A++]=o,r[A++]=s,r[A++]=i,r[A++]=c,r[A++]=d,r[A++]=w,r[A++]=b,r[A++]=v}var De=qn(xo,{counterRight:!1,counterLength:4,allowShortKeys:!1}),zi=qn(xo,{counterRight:!1,counterLength:8,extendNonceFn:Di,allowShortKeys:!1});var Ki=new Uint8Array(16),bo=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(Ki.subarray(n))},Vi=new Uint8Array(32);function mo(t,e,n,r,o){let s=t(e,n,Vi),i=ho.create(s);o&&bo(i,o),bo(i,r);let c=new Uint8Array(16),a=qt(c);Zt(a,0,BigInt(o?o.length:0),!0),Zt(a,8,BigInt(r.length),!0),i.update(c);let f=i.digest();return s.fill(0),f}var vo=t=>(e,n,r)=>(C(e,32),C(n),{encrypt:(s,i)=>{let c=s.length,a=c+16;i?C(i,a):i=new Uint8Array(a),t(e,n,s,i,1);let f=mo(t,e,n,i.subarray(0,-16),r);return i.set(f,c),i},decrypt:(s,i)=>{let c=s.length,a=c-16;if(c<16)throw new Error("encrypted data must be at least 16 bytes");i?C(i,a):i=new Uint8Array(a);let f=s.subarray(0,-16),l=s.subarray(-16),u=mo(t,e,n,f,r);if(!Vt(l,u))throw new Error("invalid tag");return t(e,n,f,i,1),i}}),mu=wt({blockSize:64,nonceLength:12,tagLength:16},vo(De)),xu=wt({blockSize:64,nonceLength:24,tagLength:16},vo(zi));var ze=class extends te{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,rt.hash(e);let r=Ot(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return rt.exists(this),this.iHash.update(e),this}digestInto(e){rt.exists(this),rt.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},se=(t,e,n)=>new ze(t,e).update(n).digest();se.create=(t,e)=>new ze(t,e);function Bo(t,e,n){return rt.hash(t),n===void 0&&(n=new Uint8Array(t.outputLen)),se(t,Ot(n),Ot(e))}var Mn=new Uint8Array([0]),Eo=new Uint8Array;function Ao(t,e,n,r=32){if(rt.hash(t),rt.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/t.outputLen);n===void 0&&(n=Eo);let s=new Uint8Array(o*t.outputLen),i=se.create(t,e),c=i._cloneInto(),a=new Uint8Array(i.outputLen);for(let f=0;f<o;f++)Mn[0]=f+1,c.update(f===0?Eo:a).update(n).update(Mn).digestInto(a),s.set(a,t.outputLen*f),i._cloneInto(c);return i.destroy(),c.destroy(),a.fill(0),Mn.fill(0),s.slice(0,r)}var Zi=Object.defineProperty,j=(t,e)=>{for(var n in e)Zi(t,n,{get:e[n],enumerable:!0})},ie=Symbol("verified"),Gi=t=>t instanceof Object;function jn(t){if(!Gi(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var Ji={};j(Ji,{Queue:()=>Fi,QueueNode:()=>Lo,binarySearch:()=>Dn,bytesToHex:()=>z,hexToBytes:()=>Bt,insertEventIntoAscendingList:()=>Qi,insertEventIntoDescendingList:()=>Xi,normalizeURL:()=>Yi,utf8Decoder:()=>_t,utf8Encoder:()=>ht});var _t=new TextDecoder("utf-8"),ht=new TextEncoder;function Yi(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function Xi(t,e){let[n,r]=Dn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function Qi(t,e){let[n,r]=Dn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function Dn(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),s=e(t[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var Lo=class{constructor(t){Yt(this,"value");Yt(this,"next",null);Yt(this,"prev",null);this.value=t}},Fi=class{constructor(){Yt(this,"first");Yt(this,"last");this.first=null,this.last=null}enqueue(t){let e=new Lo(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let e=this.first;return this.first=null,this.last=null,e.value}let t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},tc=class{generateSecretKey(){return Ft.utils.randomPrivateKey()}getPublicKey(t){return z(Ft.getPublicKey(t))}finalizeEvent(t,e){let n=t;return n.pubkey=z(Ft.getPublicKey(e)),n.id=Ke(n),n.sig=z(Ft.sign(Ke(n),e)),n[ie]=!0,n}verifyEvent(t){if(typeof t[ie]=="boolean")return t[ie];let e=Ke(t);if(e!==t.id)return t[ie]=!1,!1;try{let n=Ft.verify(t.sig,e,t.pubkey);return t[ie]=n,n}catch{return t[ie]=!1,!1}}};function ec(t){if(!jn(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Ke(t){let e=gt(ht.encode(ec(t)));return z(e)}var Ze=new tc,nc=Ze.generateSecretKey,zn=Ze.getPublicKey,xt=Ze.finalizeEvent,Kn=Ze.verifyEvent,rc={};j(rc,{Application:()=>na,BadgeAward:()=>uc,BadgeDefinition:()=>Jc,BlockedRelaysList:()=>Oc,BookmarkList:()=>kc,Bookmarksets:()=>Vc,Calendar:()=>fa,CalendarEventRSVP:()=>la,ChannelCreation:()=>Oo,ChannelHideMessage:()=>Ho,ChannelMessage:()=>Co,ChannelMetadata:()=>No,ChannelMuteUser:()=>Po,ClassifiedListing:()=>sa,ClientAuth:()=>qo,CommunitiesList:()=>Uc,CommunityDefinition:()=>da,CommunityPostApproval:()=>mc,Contacts:()=>ac,CreateOrUpdateProduct:()=>Qc,CreateOrUpdateStall:()=>Xc,Curationsets:()=>Zc,Date:()=>ca,DirectMessageRelaysList:()=>Pc,DraftClassifiedListing:()=>ia,DraftLong:()=>ta,Emojisets:()=>ea,EncryptedDirectMessage:()=>fc,EventDeletion:()=>lc,FileMetadata:()=>dc,FileServerPreference:()=>$c,Followsets:()=>Dc,GenericRepost:()=>Yn,Genericlists:()=>zc,GiftWrap:()=>$o,HTTPAuth:()=>Xn,Handlerinformation:()=>ha,Handlerrecommendation:()=>ua,Highlights:()=>Sc,InterestsList:()=>Cc,Interestsets:()=>Yc,JobFeedback:()=>Ec,JobRequest:()=>xc,JobResult:()=>vc,Label:()=>bc,LightningPubRPC:()=>Mc,LiveChatMessage:()=>pc,LiveEvent:()=>ra,LongFormArticle:()=>Fc,Metadata:()=>ic,Mutelist:()=>Lc,NWCWalletInfo:()=>qc,NWCWalletRequest:()=>Mo,NWCWalletResponse:()=>Wc,NostrConnect:()=>jc,OpenTimestamps:()=>hc,Pinlist:()=>_c,PrivateDirectMessage:()=>Ro,ProblemTracker:()=>gc,ProfileBadges:()=>Gc,PublicChatsList:()=>Rc,Reaction:()=>Jn,RecommendRelay:()=>cc,RelayList:()=>Ic,Relaysets:()=>Kc,Report:()=>yc,Reporting:()=>wc,Repost:()=>Gn,Seal:()=>Uo,SearchRelaysList:()=>Nc,ShortTextNote:()=>ko,Time:()=>aa,UserEmojiList:()=>Hc,UserStatuses:()=>oa,Zap:()=>Tc,ZapGoal:()=>Bc,ZapRequest:()=>Ac,classifyKind:()=>oc,isAddressableKind:()=>Zn,isEphemeralKind:()=>Io,isKind:()=>sc,isRegularKind:()=>_o,isReplaceableKind:()=>Vn});function _o(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Vn(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Io(t){return 2e4<=t&&t<3e4}function Zn(t){return 3e4<=t&&t<4e4}function oc(t){return _o(t)?"regular":Vn(t)?"replaceable":Io(t)?"ephemeral":Zn(t)?"parameterized":"unknown"}function sc(t,e){let n=e instanceof Array?e:[e];return jn(t)&&n.includes(t.kind)||!1}var ic=0,ko=1,cc=2,ac=3,fc=4,lc=5,Gn=6,Jn=7,uc=8,Uo=13,Ro=14,Yn=16,Oo=40,No=41,Co=42,Ho=43,Po=44,hc=1040,$o=1059,dc=1063,pc=1311,gc=1971,yc=1984,wc=1984,bc=1985,mc=4550,xc=5999,vc=6999,Ec=7e3,Bc=9041,Ac=9734,Tc=9735,Sc=9802,Lc=1e4,_c=10001,Ic=10002,kc=10003,Uc=10004,Rc=10005,Oc=10006,Nc=10007,Cc=10015,Hc=10030,Pc=10050,$c=10096,qc=13194,Mc=21e3,qo=22242,Mo=23194,Wc=23195,jc=24133,Xn=27235,Dc=3e4,zc=30001,Kc=30002,Vc=30003,Zc=30004,Gc=30008,Jc=30009,Yc=30015,Xc=30017,Qc=30018,Fc=30023,ta=30024,ea=30030,na=30078,ra=30311,oa=30315,sa=30402,ia=30403,ca=31922,aa=31923,fa=31924,la=31925,ua=31989,ha=31990,da=34550;var pa={};j(pa,{getHex64:()=>Qn,getInt:()=>Wo,getSubscriptionId:()=>ga,matchEventId:()=>ya,matchEventKind:()=>ba,matchEventPubkey:()=>wa});function Qn(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function Wo(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function ga(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return t.slice(r+1,s)}function ya(t,e){return e===Qn(t,"id")}function wa(t,e){return e===Qn(t,"pubkey")}function ba(t,e){return e===Wo(t,"kind")}var ma={};j(ma,{makeAuthEvent:()=>xa});function xa(t,e){return{kind:qo,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var va;try{va=WebSocket}catch{}var Ea;try{Ea=WebSocket}catch{}var Fn={};j(Fn,{BECH32_REGEX:()=>jo,Bech32MaxSize:()=>tr,NostrTypeGuard:()=>Ba,decode:()=>Ge,decodeNostrURI:()=>Ta,encodeBytes:()=>Ye,naddrEncode:()=>Ua,neventEncode:()=>ka,noteEncode:()=>_a,nprofileEncode:()=>Ia,npubEncode:()=>La,nsecEncode:()=>Sa});var Ba={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},tr=5e3,jo=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Aa(t){let e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function Ta(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Ge(t)}catch{return{type:"invalid",data:null}}}function Ge(t){let{prefix:e,words:n}=Pt.decode(t,tr),r=new Uint8Array(Pt.fromWords(n));switch(e){case"nprofile":{let o=Wn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:z(o[0][0]),relays:o[1]?o[1].map(s=>_t.decode(s)):[]}}}case"nevent":{let o=Wn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:z(o[0][0]),relays:o[1]?o[1].map(s=>_t.decode(s)):[],author:o[2]?.[0]?z(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(z(o[3][0]),16):void 0}}}case"naddr":{let o=Wn(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:_t.decode(o[0][0]),pubkey:z(o[2][0]),kind:parseInt(z(o[3][0]),16),relays:o[1]?o[1].map(s=>_t.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:z(r)};default:throw new Error(`unknown prefix ${e}`)}}function Wn(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function Sa(t){return Ye("nsec",t)}function La(t){return Ye("npub",Bt(t))}function _a(t){return Ye("note",Bt(t))}function Je(t,e){let n=Pt.toWords(e);return Pt.encode(t,n,tr)}function Ye(t,e){return Je(t,e)}function Ia(t){let e=er({0:[Bt(t.pubkey)],1:(t.relays||[]).map(n=>ht.encode(n))});return Je("nprofile",e)}function ka(t){let e;t.kind!==void 0&&(e=Aa(t.kind));let n=er({0:[Bt(t.id)],1:(t.relays||[]).map(r=>ht.encode(r)),2:t.author?[Bt(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return Je("nevent",n)}function Ua(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=er({0:[ht.encode(t.identifier)],1:(t.relays||[]).map(r=>ht.encode(r)),2:[Bt(t.pubkey)],3:[new Uint8Array(e)]});return Je("naddr",n)}function er(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),e.push(s)})}),ee(...e)}var Ra={};j(Ra,{decrypt:()=>Oa,encrypt:()=>Do});function Do(t,e,n){let r=t instanceof Uint8Array?z(t):t,o=Rt.getSharedSecret(r,"02"+e),s=zo(o),i=Uint8Array.from(Re(16)),c=ht.encode(n),a=Hn(s,i).encrypt(c),f=it.encode(new Uint8Array(a)),l=it.encode(new Uint8Array(i.buffer));return`${f}?iv=${l}`}function Oa(t,e,n){let r=t instanceof Uint8Array?z(t):t,[o,s]=n.split("?iv="),i=Rt.getSharedSecret(r,"02"+e),c=zo(i),a=it.decode(s),f=it.decode(o),l=Hn(c,a).decrypt(f);return _t.decode(l)}function zo(t){return t.slice(1,33)}var Na={};j(Na,{NIP05_REGEX:()=>nr,isNip05:()=>Ca,isValid:()=>$a,queryProfile:()=>Ko,searchDomain:()=>Pa,useFetchImplementation:()=>Ha});var nr=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Ca=t=>nr.test(t||""),Xe;try{Xe=fetch}catch{}function Ha(t){Xe=t}async function Pa(t,e=""){try{let n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Xe(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Ko(t){let e=t.match(nr);if(!e)return null;let[,n="_",r]=e;try{let o=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Xe(o,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");let i=await s.json(),c=i.names[n];return c?{pubkey:c,relays:i.relays?.[c]}:null}catch{return null}}async function $a(t,e){let n=await Ko(e);return n?n.pubkey===t:!1}var qa={};j(qa,{parse:()=>Ma});function Ma(t){let e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]},n,r;for(let o=t.tags.length-1;o>=0;o--){let s=t.tags[o];if(s[0]==="e"&&s[1]){let[i,c,a,f,l]=s,u={id:c,relays:a?[a]:[],author:l};if(f==="root"){e.root=u;continue}if(f==="reply"){e.reply=u;continue}if(f==="mention"){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u);continue}if(s[0]==="q"&&s[1]){let[i,c,a]=s;e.quotes.push({id:c,relays:a?[a]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(o=>{if(!o)return;let s=e.mentions.indexOf(o);if(s!==-1&&e.mentions.splice(s,1),o.author){let i=e.profiles.find(c=>c.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(c=>{o.relays?.indexOf(c)===-1&&o.relays.push(c)}),i.relays=o.relays)}}),e.mentions.forEach(o=>{if(o.author){let s=e.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),e}var Wa={};j(Wa,{fetchRelayInformation:()=>Da,useFetchImplementation:()=>ja});var Vo;try{Vo=fetch}catch{}function ja(t){Vo=t}async function Da(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var za={};j(za,{fastEventHash:()=>Go,getPow:()=>Zo,minePow:()=>Ka});function Zo(t){let e=0;for(let n=0;n<64;n+=8){let r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function Ka(t,e){let n=0,r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){let s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Go(r),Zo(r.id)>=e)break}return r}function Go(t){return z(gt(ht.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var Va={};j(Va,{unwrapEvent:()=>of,unwrapManyEvents:()=>sf,wrapEvent:()=>cs,wrapManyEvents:()=>rf});var Za={};j(Za,{createRumor:()=>rs,createSeal:()=>os,createWrap:()=>ss,unwrapEvent:()=>cr,unwrapManyEvents:()=>is,wrapEvent:()=>Ve,wrapManyEvents:()=>ef});var Ga={};j(Ga,{decrypt:()=>ir,encrypt:()=>sr,getConversationKey:()=>rr,v2:()=>Fa});var Jo=1,Yo=65535;function rr(t,e){let n=Rt.getSharedSecret(t,"02"+e).subarray(1,33);return Bo(gt,n,"nip44-v2")}function Xo(t,e){let n=Ao(gt,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function or(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;let e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Ja(t){if(!Number.isSafeInteger(t)||t<Jo||t>Yo)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Ya(t){let e=ht.encode(t),n=e.length,r=Ja(n),o=new Uint8Array(or(n)-n);return ee(r,e,o)}function Xa(t){let e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Jo||e>Yo||n.length!==e||t.length!==2+or(e))throw new Error("invalid padding");return _t.decode(n)}function Qo(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=ee(n,e);return se(gt,t,r)}function Qa(t){if(typeof t!="string")throw new Error("payload must be a valid string");let e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=it.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function sr(t,e,n=Re(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=Xo(e,n),i=Ya(t),c=De(r,o,i),a=Qo(s,c,n);return it.encode(ee(new Uint8Array([2]),n,c,a))}function ir(t,e){let{nonce:n,ciphertext:r,mac:o}=Qa(t),{chacha_key:s,chacha_nonce:i,hmac_key:c}=Xo(e,n),a=Qo(c,r,n);if(!Vt(a,o))throw new Error("invalid MAC");let f=De(s,i,r);return Xa(f)}var Fa={utils:{getConversationKey:rr,calcPaddedLen:or},encrypt:sr,decrypt:ir},tf=2880*60,Fo=()=>Math.round(Date.now()/1e3),ts=()=>Math.round(Fo()-Math.random()*tf),es=(t,e)=>rr(t,e),ns=(t,e,n)=>sr(JSON.stringify(t),es(e,n)),To=(t,e)=>JSON.parse(ir(t.content,es(e,t.pubkey)));function rs(t,e){let n={created_at:Fo(),content:"",tags:[],...t,pubkey:zn(e)};return n.id=Ke(n),n}function os(t,e,n){return xt({kind:Uo,content:ns(t,e,n),created_at:ts(),tags:[]},e)}function ss(t,e){let n=nc();return xt({kind:$o,content:ns(t,n,e),created_at:ts(),tags:[["p",e]]},n)}function Ve(t,e,n){let r=rs(t,e),o=os(r,e,n);return ss(o,n)}function ef(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");let r=zn(e),o=[Ve(t,e,r)];return n.forEach(s=>{o.push(Ve(t,e,s))}),o}function cr(t,e){let n=To(t,e);return To(n,e)}function is(t,e){let n=[];return t.forEach(r=>{n.push(cr(r,e))}),n.sort((r,o)=>r.created_at-o.created_at),n}function nf(t,e,n,r){let o={created_at:Math.ceil(Date.now()/1e3),kind:Ro,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:i,relayUrl:c})=>{o.tags.push(c?["p",i,c]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function cs(t,e,n,r,o){let s=nf(e,n,r,o);return Ve(s,t,e.publicKey)}function rf(t,e,n,r,o){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:zn(t)},...e].map(i=>cs(t,i,n,r,o))}var of=cr,sf=is,cf={};j(cf,{finishRepostEvent:()=>af,getRepostedEvent:()=>ff,getRepostedEventPointer:()=>as});function af(t,e,n,r){let o,s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===ko?o=Gn:(o=Yn,s.push(["k",String(e.kind)])),xt({kind:o,tags:s,content:t.content===""||e.tags?.find(i=>i[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function as(t){if(![Gn,Yn].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function ff(t,{skipVerification:e}={}){let n=as(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!Kn(r)))return r}var lf={};j(lf,{NOSTR_URI_REGEX:()=>ar,parse:()=>hf,test:()=>uf});var ar=new RegExp(`nostr:(${jo.source})`);function uf(t){return typeof t=="string"&&new RegExp(`^${ar.source}$`).test(t)}function hf(t){let e=t.match(new RegExp(`^${ar.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Ge(e[1])}}var df={};j(df,{finishReactionEvent:()=>pf,getReactedEventPointer:()=>gf});function pf(t,e,n){let r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return xt({...t,kind:Jn,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function gf(t){if(t.kind!==Jn)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var yf={};j(yf,{parse:()=>bf});var wf=/\W/m,So=/\W |\W$|$|,| /m;function*bf(t){let e=t.length,n=0,r=0;for(;r<e;){let o=t.indexOf(":",r);if(o===-1)break;if(t.substring(o-5,o)==="nostr"){let s=t.substring(o+60).match(wf),i=s?o+60+s.index:e;try{let c,{data:a,type:f}=Ge(t.substring(o+1,i));switch(f){case"npub":c={pubkey:a};break;case"nsec":case"note":r=i+1;continue;default:c=a}n!==o-5&&(yield{type:"text",text:t.substring(n,o-5)}),yield{type:"reference",pointer:c},r=i,n=r;continue}catch{r=o+1;continue}}else if(t.substring(o-5,o)==="https"||t.substring(o-4,o)==="http"){let s=t.substring(o+4).match(So),i=s?o+4+s.index:e,c=t[o-1]==="s"?5:4;try{let a=new URL(t.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),/\.(png|jpe?g|gif|webp)$/i.test(a.pathname)){yield{type:"image",url:a.toString()},r=i,n=r;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(a.pathname)){yield{type:"video",url:a.toString()},r=i,n=r;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(a.pathname)){yield{type:"audio",url:a.toString()},r=i,n=r;continue}yield{type:"url",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else if(t.substring(o-3,o)==="wss"||t.substring(o-2,o)==="ws"){let s=t.substring(o+4).match(So),i=s?o+4+s.index:e,c=t[o-1]==="s"?3:2;try{let a=new URL(t.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),yield{type:"relay",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else{r=o+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var mf={};j(mf,{channelCreateEvent:()=>xf,channelHideMessageEvent:()=>Bf,channelMessageEvent:()=>Ef,channelMetadataEvent:()=>vf,channelMuteUserEvent:()=>Af});var xf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Oo,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},vf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:No,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Ef=(t,e)=>{let n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),xt({kind:Co,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Bf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Ho,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Af=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return xt({kind:Po,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},Tf={};j(Tf,{EMOJI_SHORTCODE_REGEX:()=>fs,matchAll:()=>Sf,regex:()=>fr,replaceAll:()=>Lf});var fs=/:(\w+):/,fr=()=>new RegExp(`\\B${fs.source}\\B`,"g");function*Sf(t){let e=t.matchAll(fr());for(let n of e)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Lf(t,e){return t.replaceAll(fr(),(n,r)=>e({shortcode:n,name:r}))}var _f={};j(_f,{useFetchImplementation:()=>If,validateGithub:()=>kf});var lr;try{lr=fetch}catch{}function If(t){lr=t}async function kf(t,e,n){try{return await(await lr(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var Uf={};j(Uf,{makeNwcRequestEvent:()=>Of,parseConnectionString:()=>Rf});function Rf(t){let{host:e,pathname:n,searchParams:r}=new URL(t),o=n||e,s=r.get("relay"),i=r.get("secret");if(!o||!s||!i)throw new Error("invalid connection string");return{pubkey:o,relay:s,secret:i}}async function Of(t,e,n){let o=Do(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Mo,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return xt(s,e)}var Nf={};j(Nf,{normalizeIdentifier:()=>Cf});function Cf(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>/\p{Letter}/u.test(e)||/\p{Number}/u.test(e)?e:"-").join("")}var Hf={};j(Hf,{getSatoshisAmountFromBolt11:()=>jf,getZapEndpoint:()=>$f,makeZapReceipt:()=>Wf,makeZapRequest:()=>qf,useFetchImplementation:()=>Pf,validateZapRequest:()=>Mf});var ur;try{ur=fetch}catch{}function Pf(t){ur=t}async function $f(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(r){let[i,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${i}`,`https://${c}`).toString()}else if(n){let{words:i}=Pt.decode(n,1e3),c=Pt.fromWords(i);e=_t.decode(c)}else return null;let s=await(await ur(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function qf(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),Vn(t.event.kind)){let n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(Zn(t.event.kind)){let n=t.event.tags.find(([o,s])=>o==="d"&&s);if(!n)throw new Error("d tag not found or is empty");let r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function Mf(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!jn(e))return"Zap request is not a valid Nostr event.";if(!Kn(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function Wf({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}function jf(t){if(t.length<50)return 0;t=t.substring(0,50);let e=t.lastIndexOf("1");if(e===-1)return 0;let n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;let r=n.substring(4);if(r.length<1)return 0;let o=r[r.length-1],s=o.charCodeAt(0)-48,i=s>=0&&s<=9,c=r.length-1;if(i&&c++,c<1)return 0;let a=parseInt(r.substring(0,c));switch(o){case"m":return a*1e5;case"u":return a*100;case"n":return a/10;case"p":return a/1e4;default:return a*1e8}}var Df={};j(Df,{getToken:()=>zf,hashPayload:()=>hr,unpackEventFromToken:()=>us,validateEvent:()=>ws,validateEventKind:()=>ds,validateEventMethodTag:()=>gs,validateEventPayloadTag:()=>ys,validateEventTimestamp:()=>hs,validateEventUrlTag:()=>ps,validateToken:()=>Kf});var ls="Nostr ";async function zf(t,e,n,r=!1,o){let s={kind:Xn,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",hr(o)]);let i=await n(s);return(r?ls:"")+it.encode(ht.encode(JSON.stringify(i)))}async function Kf(t,e,n){let r=await us(t).catch(s=>{throw s});return await ws(r,e,n).catch(s=>{throw s})}async function us(t){if(!t)throw new Error("Missing token");t=t.replace(ls,"");let e=_t.decode(it.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function hs(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function ds(t){return t.kind===Xn}function ps(t,e){let n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function gs(t,e){let n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function hr(t){let e=gt(ht.encode(JSON.stringify(t)));return z(e)}function ys(t,e){let n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=hr(e);return n.length>0&&n[1]===r}async function ws(t,e,n,r){if(!Kn(t))throw new Error("Invalid nostr event, signature invalid");if(!ds(t))throw new Error("Invalid nostr event, kind invalid");if(!hs(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ps(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!gs(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!ys(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function bs(t){try{let e=Fn.decode(t);return e.type==="nevent"?{type:"event",data:{id:e.data.id,relays:e.data.relays||[]}}:e.type==="note"?{type:"event",data:{id:e.data,relays:[]}}:e.type==="naddr"?{type:"address",data:{kind:e.data.kind,pubkey:e.data.pubkey,identifier:e.data.identifier,relays:e.data.relays||[]}}:null}catch(e){return console.error("[Nostr Decoder] Failed to decode identifier:",e),null}}function Vf(){return["wss://relay.divine.video","wss://relay.nostr.band","wss://relay.damus.io"]}function ms(t=[],e=[]){let n=[...e,...t,...Vf()];return[...new Set(n)]}async function xs(){console.log("[Nostube Embed] Initializing player...");let t=wr(),e=br(t);if(!e.valid){console.error("[Nostube Embed] Invalid configuration:",e.error),vs(e.error);return}console.log("[Nostube Embed] Configuration:",t);let n=bs(t.videoId);if(!n){vs("Failed to decode video identifier");return}console.log("[Nostube Embed] Decoded identifier:",n);let r=ms(n.data.relays,t.customRelays);console.log("[Nostube Embed] Using relays:",r)}function vs(t){document.body.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center;
                height: 100vh; background: #000; color: #fff;
                font-family: system-ui, -apple-system, sans-serif;
                text-align: center; padding: 20px;">
      <div>
        <div style="font-size: 48px; margin-bottom: 16px;">\u26A0\uFE0F</div>
        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Error</div>
        <div style="font-size: 14px; color: #999;">${t}</div>
      </div>
    </div>
  `}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",xs):xs();})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
